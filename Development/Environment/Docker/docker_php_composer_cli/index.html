<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Docker + PHP + Composer - Sandbox</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">Sandbox</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../../.." class="nav-link">Index</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Environment</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">DDEV</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../DDEV/" class="dropdown-item">DDEV: index</a>
</li>
            
<li>
    <a href="../../DDEV/ddev_misc/" class="dropdown-item">DDEV: misc</a>
</li>
            
<li>
    <a href="../../DDEV/ddev_setup/" class="dropdown-item">DDEV: project setup</a>
</li>
            
<li>
    <a href="../../DDEV/ddev_usage/" class="dropdown-item">DDEV: usage</a>
</li>
            
<li>
    <a href="../../DDEV/ddev_windows/" class="dropdown-item">DDEV: Windows</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Docker</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../" class="dropdown-item">Docker: index</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Docker + PHP + Composer</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">WSL</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../WSL/" class="dropdown-item">WSL: index</a>
</li>
            
<li>
    <a href="../../WSL/wsl_misc/" class="dropdown-item">WSL</a>
</li>
            
<li>
    <a href="../../WSL/wsl_vscode/" class="dropdown-item">vscode + WSL</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Xdebug</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../Xdebug/" class="dropdown-item">Xdebug: index</a>
</li>
            
<li>
    <a href="../../Xdebug/xdebug_ddev_vscode/" class="dropdown-item">Xdebug + DDEV + Visual Studio Code</a>
</li>
            
<li>
    <a href="../../Xdebug/xdebug_troubleshooting/" class="dropdown-item">Xdebug troubleshooting</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">PHP</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../PHP/ErrorHandling/" class="dropdown-item">Error Handling</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Application</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../PHP/Application/" class="dropdown-item">PHP: Application: index</a>
</li>
            
<li>
    <a href="../../../PHP/Application/application_setup/" class="dropdown-item">PHP: Application setup</a>
</li>
            
<li>
    <a href="../../../PHP/Application/application_structure/" class="dropdown-item">Application: Project structure</a>
</li>
            
<li>
    <a href="../../../PHP/Application/application_workflow/" class="dropdown-item">Application: Workflow (WIP)</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Tools</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Tools/StaticAnalisys/" class="dropdown-item">Static analisys</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../WSL/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#docker-php-composer" class="nav-link">Docker + PHP + Composer</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#setup" class="nav-link">Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#usage" class="nav-link">Usage</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#external-resources" class="nav-link">External resources</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="docker-php-composer">Docker + PHP + Composer</h1>
<p>PHP library/package/CLI development without having the required PHP / Composer versions installed locally.</p>
<p>No web interface.</p>
<h2 id="setup">Setup</h2>
<p>Copy needed files from the repository.</p>
<p>Hint: <a href="https://stackoverflow.com/a/18324458">Download only one specific folder from a remote repository</a>:</p>
<pre><code class="language-sh"># View
svn ls https://github.com/webservco/sandbox.git/trunk/.docker
# Download
svn export https://github.com/webservco/sandbox.git/trunk/.docker
</code></pre>
<hr />
<h2 id="usage">Usage</h2>
<h3 id="1-copy-snapshot-mode">1) Copy (snapshot) mode</h3>
<ul>
<li>Read comments / edit to customize: <code>.docker/config/php82-cli-copy/Dockerfile</code></li>
<li>Use case: check project in isolation, without adding the vendor dir on local (avoid PHAN errors);</li>
<li>Files are copied into the container at build time (not updated in real-time);</li>
<li>Working on a "snapshot" done at the time of the build</li>
<li>Installs composer dependencies</li>
<li>Runs all checks by default</li>
</ul>
<pre><code class="language-sh">
# Build:
BUILD_TEMP_DIR='.docker/assets/temp/';
# Create temporary directory for special project dependencies (local).
mkdir --parents ${BUILD_TEMP_DIR}p/parcelvalue-v3/framework/
# Copy files into the temporary directory (local).
cp --recursive ~/p/parcelvalue-v3/framework/ ${BUILD_TEMP_DIR}p/parcelvalue-v3/
# Build.
docker build -t lhost-v3-framework-copy -f .docker/config/php82-cli-copy/Dockerfile .
# Cleanup temporary directory.
rm -rf ${BUILD_TEMP_DIR}*

# Run: default command: run all checks
docker run -it --rm --name lhost-v3-framework-running lhost-v3-framework-copy

# Run: custom command (default command is not executed)
docker run -it --rm --name lhost-v3-framework-running lhost-v3-framework-copy /bin/bash -c &quot;ls -lah vendor&quot;
</code></pre>
<h3 id="2-mount-real-time-mode">2) Mount (real-time) mode</h3>
<ul>
<li>Read comments / edit to customize: <code>.docker/config/php82-cli-mount/Dockerfile</code></li>
<li>Use case: active development, need to run quickly on up-to-date files; need vendor dir (or no problem if present);</li>
<li>Files are mounted at run time, so no composer commands are run automatically</li>
<li>Execute any commands needed at run time</li>
<li>Caveat: This mode is unuseful if using special dependencies;<ul>
<li>since mounted in a different path in the container, they will not be available on the local filesystem (so not able to run composer commands on local or have code available in vscode for example);</li>
</ul>
</li>
</ul>
<pre><code class="language-sh"># Build.
docker build -t lhost-v3-framework-mount -f .docker/config/php82-cli-mount/Dockerfile .

# Run (specify mounts and commands to run)
docker run -it --rm --name lhost-v3-framework-running \
# special dependencies
--mount src=&quot;$HOME/p/parcelvalue-v3/framework/&quot;,target=/home/dev/p/parcelvalue-v3/framework/,type=bind \
# project code
--mount src=.,target=/home/dev/project,type=bind \
lhost-v3-framework-mount \
/bin/bash -c &quot;composer update &amp;&amp; composer all&quot;
</code></pre>
<hr />
<h2 id="external-resources">External resources</h2>
<ul>
<li>https://hub.docker.com/_/php/</li>
<li>https://hub.docker.com/_/composer</li>
<li>https://medium.com/@othillo/adding-composer-to-php-docker-images-using-multi-stage-builds-2a10967ae6c1</li>
</ul>
<hr /></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
